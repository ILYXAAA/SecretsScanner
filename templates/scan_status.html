<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scan Status - Secrets Scanner</title>
    <link rel="stylesheet" href="/secret_scanner/static/css/base_header.css">
    <link rel="stylesheet" href="/secret_scanner/static/css/scan_status.css">
    <link rel="icon" type="image/x-icon" href="/secret_scanner/favicon.ico">
</head>
<body data-scan-status="{{ scan.status if scan.status else 'unknown' }}" 
      data-scan-id="{{ scan.id }}" 
      data-project-name="{{ scan.project_name }}"
      data-callback-url="{{ callback_url if callback_url else '' }}"
      data-scan-started-at="{{ scan.started_at.strftime('%Y-%m-%dT%H:%M:%S') if scan.started_at else '' }}"
      data-scan-started-at-display="{{ scan.started_at.strftime('%d.%m.%Y %H:%M') if scan.started_at else '' }}">
    {% from "components/base_header.html" import header %}
    {{ header('', current_user) }}
    
    <div class="container">
        <div class="scan-status-card">
            <div id="status-content">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                <div class="loading-spinner"></div>
                <div class="status-icon">üîÑ</div>
                <h1 class="status-title">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...</h1>
                <p class="status-description">
                    –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è...
                </p>
            </div>
            
            <div class="scan-details">
                <div class="scan-detail-item">
                    <span class="scan-detail-label">–ü—Ä–æ–µ–∫—Ç:</span>
                    <span class="scan-detail-value">{{ scan.project_name }}</span>
                </div>
                <div class="scan-detail-item">
                    <span class="scan-detail-label">Reference Type:</span>
                    <span class="scan-detail-value">{{ scan.ref_type if scan.ref_type else 'N/A' }}</span>
                </div>
                <div class="scan-detail-item">
                    <span class="scan-detail-label">Reference:</span>
                    <span class="scan-detail-value">{{ scan.ref if scan.ref else 'N/A' }}</span>
                </div>
                {% if scan.repo_commit %}
                <div class="scan-detail-item">
                    <span class="scan-detail-label">Commit:</span>
                    <span class="scan-detail-value commit-display">{{ scan.repo_commit }}</span>
                </div>
                {% endif %}
                <div class="scan-detail-item">
                    <span class="scan-detail-label">Scan ID:</span>
                    <span class="scan-detail-value">{{ scan.id }}</span>
                </div>
                <div class="scan-detail-item" id="started-at-detail">
                    <span class="scan-detail-label">–ó–∞–ø—É—â–µ–Ω:</span>
                    <span class="scan-detail-value">{{ scan.started_at.strftime('%d.%m.%Y %H:%M') if scan.started_at else '–ù–µ –∑–∞–ø—É—â–µ–Ω' }}</span>
                </div>
                <div class="scan-detail-item" id="completed-at-detail" style="display: none;">
                    <span class="scan-detail-label">–ó–∞–≤–µ—Ä—à–µ–Ω:</span>
                    <span class="scan-detail-value" id="completed-at-value">-</span>
                </div>
                <div class="scan-detail-item" id="execution-time-detail" style="display: none;">
                    <span class="scan-detail-label">–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</span>
                    <span class="scan-detail-value" id="execution-time-value">-</span>
                </div>
            </div>
            
            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è - –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á -->
            <div id="progress-section" style="display: none;">
                <div class="progress-info">
                    <div class="progress-text" id="progress-status-text">–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ...</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                    </div>
                    <div class="progress-percentage" id="progress-percentage">0%</div>
                    <div class="progress-detail" id="progress-detail"></div>
                </div>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
            <div id="results-section" style="display: none;">
                <div class="files-scanned" id="results-info">
                    üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ—Ç–æ–≤—ã
                </div>
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ -->
            <div id="error-section" style="display: none;">
                <div class="error-info">
                    <div class="error-title">‚ùå –û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</div>
                    <div class="error-message" id="error-message"></div>
                </div>
            </div>

            <!-- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á) -->
            <div class="elapsed-time" id="elapsedTime" style="display: none;">
                –ó–∞–ø—É—â–µ–Ω: {{ scan.started_at.strftime('%d.%m.%Y %H:%M') if scan.started_at else 'N/A' }}
            </div>

            <div class="logs-info" id="logs-info" style="display: none;">
                <div class="logs-info-title">
                    üí° –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ
                </div>
                <div class="logs-info-text" id="logs-info-text">
                    –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º —Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.
                </div>
                <div class="logs-button-container">
                    <a href="/secret_scanner/logs" class="btn btn-info">
                        üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
                    </a>
                </div>
            </div>
            
            <div style="margin-top: 2rem;" id="action-buttons">
                <a href="/secret_scanner/project/{{ scan.project_name }}" class="btn btn-secondary">
                    ‚Üê –ù–∞–∑–∞–¥ –∫ –ø—Ä–æ–µ–∫—Ç—É
                </a>
                
                <button class="btn btn-info" id="refresh-btn" onclick="refreshStatus()">
                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
                </button>

                <!-- –ö–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                <div id="dynamic-buttons"></div>
            </div>
        </div>
    </div>
    <script src="/secret_scanner/static/js/scan_status.js"></script>
</body>
</html>