<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ project.name }} - Secrets Scanner</title>
    <link rel="stylesheet" href="/secret_scanner/static/css/project.css">
    <link rel="icon" type="image/x-icon" href="/secret_scanner/favicon.ico">
</head>
<body data-language-stats='{{ language_stats | tojson if language_stats else "[]" }}' 
      data-project-repo-url="{{ project.repo_url }}" 
      data-latest-scan-commit="{{ latest_scan.repo_commit if latest_scan and latest_scan.repo_commit else 'main' }}" 
      data-hub-type="{{ HUB_TYPE }}" 
      data-latest-scan-status="{{ latest_scan.status if latest_scan else '' }}"
      data-current-project-name="{{ project.name }}">
    <header class="header">
        <a href="/secret_scanner/dashboard" class="logo">
            üîç Secrets Scanner
        </a>
        <nav class="nav-links">
            <a href="/secret_scanner/dashboard">üåê –ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/secret_scanner/multi-scan">üîÑ –ú—É–ª—å—Ç–∏—Å–∫–∞–Ω</a>
            {% if current_user == "admin" %}
                <a href="/secret_scanner/admin">üëë –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</a>
                <a href="/secret_scanner/admin/workers" class="active">‚öôÔ∏è –°–µ—Ä–≤–∏—Å</a>
            {% endif %}
            <a href="/secret_scanner/settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
            <a href="/secret_scanner/logout">üîö –í—ã–π—Ç–∏</a>
        </nav>
    </header>
    
    <div class="container">
        <div class="project-header">
            <h1 class="project-title">
                <span class="project-icon">üìÅ</span>
                {{ project.name }}
            </h1>
            <div class="project-url">
                <a href="{{ project.repo_url }}" target="_blank">üîó {{ project.repo_url }}</a>
                {% if project.created_by %}
                <div style="font-size: 0.85rem; color: #666; margin-top: 0.25rem;">
                    üëÆ –°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º: <b><span style="color: #28a745;">{{ project.created_by }}</span></b>
                </div>
                {% endif %}
            </div>
            <div class="project-actions">
                {% if 'devzone.local' in project.repo_url %}
                <button class="btn btn-success btn-disabled" disabled>
                    <s>–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</s>
                </button>
                <div style="font-size: 0.8rem; color: #666; margin-top: 0.25rem; max-width: 300px;">
                    ‚ùå –û–Ω–ª–∞–π–Ω —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ DevZone —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.<br>
                    –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ZIP-–∞—Ä—Ö–∏–≤–æ–º.
                </div>
                {% else %}
                <button class="btn btn-success" onclick="toggleScanForm()">
                    –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                </button>
                {% endif %}
                <button class="btn btn-zip-scan" onclick="toggleLocalScanForm()">
                    üóÇÔ∏è –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ZIP
                </button>
                <button class="btn btn-warning" onclick="toggleEditForm()">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="btn btn-danger" onclick="deleteProject({{ project.id }})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
                <button class="btn btn-merge" onclick="toggleMergeForm()">üîó –û–±—ä–µ–¥–∏–Ω–∏—Ç—å</button>
            </div>
        </div>
        
        {% if request.url.query %}
            {% if 'error=microservice_unavailable' in request.url.query %}
            <div class="alert alert-error">Microservice is unavailable. Please check if the scanning service is running.</div>
            {% elif 'error=microservice_timeout' in request.url.query %}
            <div class="alert alert-error">Request to microservice timed out. Please try again.</div>
            {% elif 'error=microservice_connection_error' in request.url.query %}
            <div class="alert alert-error">Unable to connect to microservice. Please check the service status.</div>
            {% elif 'error=microservice_invalid_response' in request.url.query %}
            <div class="alert alert-error">Microservice returned an invalid response.</div>
            {% elif 'success=scan_deleted' in request.url.query %}
            <div class="alert alert-success">Scan deleted successfully.</div>
            {% elif 'success=project_updated' in request.url.query %}
            <div class="alert alert-success">–î–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã.</div>
            {% elif 'error=project_exists' in request.url.query %}
            <div class="alert alert-error">–ü—Ä–æ–µ–∫—Ç —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.</div>
            {% elif 'error=project_not_found' in request.url.query %}
            <div class="alert alert-error">–ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.</div>
            {% elif 'error=project_update_failed' in request.url.query %}
            <div class="alert alert-error">–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç.</div>
            {% elif 'error=empty_merge_fields' in request.url.query %}
            <div class="alert alert-error">‚ùå –í—Å–µ –ø–æ–ª—è –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã.</div>
            {% elif 'error=same_project_merge' in request.url.query %}
            <div class="alert alert-error">‚ùå –ù–µ–ª—å–∑—è –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç —Å —Å–∞–º–∏–º —Å–æ–±–æ–π.</div>
            {% elif 'error=main_project_not_found' in request.url.query %}
            <div class="alert alert-error">‚ùå –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.</div>
            {% elif 'error=target_project_not_found' in request.url.query %}
            <div class="alert alert-error">‚ùå –¶–µ–ª–µ–≤–æ–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω.</div>
            {% elif 'error=project_merge_failed' in request.url.query %}
            <div class="alert alert-error">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.</div>
            {% elif 'success=project_merged' in request.url.query %}
            <div class="alert alert-success">‚úÖ –ü—Ä–æ–µ–∫—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã! –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: {{ request.url.query.split('merged_scans=')[1].split('&')[0] if 'merged_scans=' in request.url.query else '0' }}</div>
            {% elif 'error=' in request.url.query %}
            <div class="alert alert-error">{{ request.url.query.split('error=')[1].split('&')[0] | urldecode }}</div>
            {% elif 'error=invalid_file_format' in request.url.query %}
            <div class="alert alert-error">–§–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ ZIP</div>
            {% elif 'error=local_scan_failed' in request.url.query %}
            <div class="alert alert-error">–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</div>
            {% endif %}
        {% endif %}
        
        <div class="edit-project-form" id="editProjectForm">
            <h2 class="section-title">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</h2>
            <form method="post" action="/secret_scanner/projects/update">
                <input type="hidden" name="project_id" value="{{ project.id }}">
                <div class="form-group">
                    <label for="project_name">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</label>
                    <input type="text" id="project_name" name="project_name" value="{{ project.name }}" required 
                           pattern="[a-zA-Z0-9._\-\s]+" 
                           title="–î–æ–ø—É—Å—Ç–∏–º—ã –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, —Ç–æ—á–∫–∏, –¥–µ—Ñ–∏—Å—ã, –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–±–µ–ª—ã">
                </div>
                <div class="form-group">
                    <label for="repo_url">–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π</label>
                    {% if HUB_TYPE == "Azure" %}
                    <input type="url" id="repo_url" name="repo_url" value="{{ project.repo_url }}" required>
                    <small style="color: #666; font-size: 0.85rem;">
                        –§–æ—Ä–º–∞—Ç –¥–ª—è Azure DevOps: http://server/collection/project/_git/repository<br>
                        –∏–ª–∏ http://server/collection/_git/repository
                    </small>
                    {% else %}
                    <input type="url" id="repo_url" name="repo_url" value="{{ project.repo_url }}" required>
                    <small style="color: #666; font-size: 0.85rem;">
                        –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è GitHub, GitLab, Bitbucket –∏ –¥—Ä—É–≥–∏–µ Git-—Ö–æ—Å—Ç–∏–Ω–≥–∏
                    </small>
                    {% endif %}
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
                    <button type="button" class="btn btn-secondary" onclick="toggleEditForm()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>

        <!-- Merge Project Form -->
        <div id="mergeProjectForm" class="merge-project-form">
            <h2 class="merge-form-title">üîó –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç—ã</h2>
            <div class="merge-form-description">
                <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –≠—Ç–æ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–≤–∞ –ø—Ä–æ–µ–∫—Ç–∞ –≤ –æ–¥–∏–Ω. –í—Å–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –±—É–¥—É—Ç –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç, –∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω. 
                <br><br>
                <strong>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –ø—Ä–æ–µ–∫—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–≥–¥–∞ –æ–¥–∏–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–∑–¥–∞–Ω —Å —Ä–∞–∑–Ω—ã–º–∏ URL).
            </div>
            <form action="/secret_scanner/projects/merge" method="post">
                <input type="hidden" name="main_project_name" value="{{ project.name }}">
                <div class="form-group">
                    <label for="target_project_name">–ü—Ä–æ–µ–∫—Ç –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è:</label>
                    <div class="autocomplete-container">
                        <input type="text" id="target_project_name" name="target_project_name" 
                               placeholder="–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞..." required>
                        <div id="project_dropdown" class="project-dropdown"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="new_repo_url">–§–∏–Ω–∞–ª—å–Ω—ã–π URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:</label>
                    <input type="url" id="new_repo_url" name="new_repo_url" 
                           value="{{ project.repo_url }}" 
                           placeholder="URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, –∫–æ—Ç–æ—Ä—ã–π –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-merge" onclick="mergeProjects()">üîó –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç—ã</button>
                    <button type="button" class="btn btn-secondary" onclick="toggleMergeForm()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
        
        <div class="scan-form" id="scanForm">
            <h2 class="section-title">üÜï –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
            <form method="post" action="/secret_scanner/project/{{ project.name }}/scan">
                <div class="form-group">
                    <label for="ref_type">Reference Type:</label>
                    <select id="ref_type" name="ref_type" required>
                        <option value="Branch">Branch</option>
                        <option value="Tag">Tag</option>
                        <option value="Commit">Commit</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="ref">Reference:</label>
                    <input type="text" id="ref" name="ref" placeholder="main" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button type="button" class="btn btn-secondary" onclick="toggleScanForm()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>

        <div class="scan-form" id="localScanForm">
            <h2 class="section-title">üì¶ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ZIP-–∞—Ä—Ö–∏–≤–∞</h2>
            <form method="post" action="/secret_scanner/project/{{ project.name }}/local-scan" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="commit">–ö–æ–º–º–∏—Ç (<span style="color: #dc3545;">required</span>):</label>
                    <input type="text" id="commit" name="commit" placeholder="a1b2c3d4..." required>
                    <small style="color: #666; font-size: 0.85rem;">
                        SHA –∫–æ–º–º–∏—Ç–∞, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É ZIP-–∞—Ä—Ö–∏–≤–∞
                    </small>
                </div>
                <div class="form-group">
                    <label for="zip_file">ZIP-—Ñ–∞–π–ª —Å –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º:</label>
                    <div class="file-upload-area" id="fileUploadArea">
                        <div class="file-upload-content">
                            <div class="file-upload-icon">üìÅ</div>
                            <div class="file-upload-text">
                                <strong>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ ZIP-—Ñ–∞–π–ª —Å—é–¥–∞</strong><br>
                                –∏–ª–∏ <span class="file-upload-browse">–≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</span>
                            </div>
                        </div>
                        <input type="file" id="zip_file" name="zip_file" accept=".zip" required hidden>
                    </div>
                    <div class="file-info" id="fileInfo" style="display: none;">
                        <span id="fileName"></span>
                        <button type="button" class="file-remove" onclick="removeFile()">‚úï</button>
                    </div>
                    <small style="color: #666; font-size: 0.85rem;">
                        –í—ã–±–µ—Ä–∏—Ç–µ ZIP-–∞—Ä—Ö–∏–≤ —Å –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º –ø—Ä–æ–µ–∫—Ç–∞
                    </small>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫–∞–Ω</button>
                    <button type="button" class="btn btn-secondary" onclick="toggleLocalScanForm()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
        
        {% if latest_scan %}
        <div class="latest-scan">
            <h2 class="section-title">üîç –ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–∫–∞–Ω</h2>
            <div class="scan-info">
                <div class="scan-info-item">
                    <div class="scan-info-label">üìä –°—Ç–∞—Ç—É—Å</div>
                    <div class="scan-info-value">
                        <span class="scan-status {{ latest_scan.status }}">
                            {% if latest_scan.status == 'running' %}‚è≥ Running
                            {% elif latest_scan.status == 'completed' %}‚úÖ Completed
                            {% else %}‚ùå Failed
                            {% endif %}
                        </span>
                    </div>
                </div>
                <div class="scan-info-item">
                    <div class="scan-info-label">üïë –ó–∞–ø—É—â–µ–Ω</div>
                    <div class="scan-info-value">{{ latest_scan.started_at.strftime('%d.%m.%Y %H:%M') }}</div>
                </div>
                {% if latest_scan.repo_commit %}
                <div class="scan-info-item">
                    <div class="scan-info-label">‚öôÔ∏è Commit</div>
                    <div class="scan-info-value">{{ latest_scan.repo_commit }}</div>
                </div>
                {% endif %}
                <div class="scan-info-item">
                    <div class="scan-info-label">‚ò∞ –ó–∞–ø—É—â–µ–Ω –ø–æ</div>
                    <div class="scan-info-value">{{ latest_scan.ref_type }}: {{ latest_scan.ref }}</div>
                </div>
                {% if latest_scan.files_scanned %}
                <div class="scan-info-item">
                    <div class="scan-info-label">üìÇ –§–∞–π–ª–æ–≤ –Ω–∞–π–¥–µ–Ω–æ</div>
                    <div class="scan-info-value">{{ latest_scan.files_scanned }}</div>
                </div>
                {% endif %}
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ -->
            {% if framework_stats %}
            <div class="frameworks-section" style="margin-bottom: 1.5rem;">
                <div class="frameworks-header" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                    <span style="font-size: 1.1rem; font-weight: 600; color: #333;">üéØ –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏</span>
                </div>
                <div class="frameworks-list" style="display: flex; flex-wrap: wrap; gap: 0.75rem;">
                    {% for framework, data in framework_stats.items() %}
                    <div class="framework-item" data-framework="{{ framework }}" style="background: white; border: 1px solid #e1e5e9; border-radius: 8px; padding: 0.75rem; display: flex; align-items: center; gap: 0.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                        {% if data.icon %}
                        <img src="{{ '/secret_scanner/' + data.icon if data.icon else '' }}" alt="{{ framework }}" style="width: 24px; height: 24px;">
                        {% else %}
                        <div style="width: 24px; height: 24px; background-color: {{ data.color }}; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px; font-weight: 600;">
                            {{ framework[:2].upper() }}
                        </div>
                        {% endif %}
                        <span style="font-weight: 500;">{{ framework }}</span>
                        <button class="framework-details-btn" onclick="toggleFrameworkDetails('{{ framework }}')" 
                                style="background: #f0f9ff; border: 1px solid #0ea5e9; color: #0ea5e9; border-radius: 4px; padding: 0.25rem 0.5rem; font-size: 0.75rem; cursor: pointer;">
                            üìã –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                        </button>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- –î–µ—Ç–∞–ª–∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ -->
                {% for framework, data in framework_stats.items() %}
                <div class="framework-details" id="framework-details-{{ framework }}" style="display: none; margin-top: 1rem; background: #f8f9fa; border: 1px solid #e1e5e9; border-radius: 8px; padding: 1rem;">
                    <div style="font-weight: 600; margin-bottom: 0.75rem; color: #333;">üîç –î–µ—Ç–∞–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è {{ framework }}:</div>
                    {% for detection in data.detections %}
                    <div style="background: white; border-radius: 6px; padding: 0.75rem; margin-bottom: 0.5rem; border-left: 3px solid {{ data.color }};">
                        <div style="font-size: 0.9rem; color: #333; margin-bottom: 0.5rem;">{{ detection.Description }}</div>
                        <div style="font-size: 0.8rem; color: #666;">
                            <div style="font-weight: 500; margin-bottom: 0.25rem;">üìÑ –§–∞–π–ª—ã:</div>
                            {% if detection.Files %}
                                {% for file in detection.Files %}
                                <div style="margin-left: 1rem; margin-bottom: 0.15rem;">
                                    <a href="#" onclick="openFrameworkFile('{{ file }}', '{{ framework }}')" style="color: #0ea5e9; text-decoration: underline; cursor: pointer;">{{ file }}</a>
                                </div>
                                {% endfor %}
                            {% elif detection.File %}
                                <!-- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –≥–¥–µ-—Ç–æ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è -->
                                <div style="margin-left: 1rem;">
                                    <a href="#" onclick="openFrameworkFile('{{ detection.File }}', '{{ framework }}')" style="color: #0ea5e9; text-decoration: underline; cursor: pointer;">{{ detection.File }}</a>
                                </div>
                            {% else %}
                                <div style="margin-left: 1rem; color: #666; font-style: italic;">–§–∞–π–ª—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã</div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —è–∑—ã–∫–æ–≤ -->
            {% if language_stats %}
            <button class="language-stats-toggle" onclick="toggleLanguageStats()">
                <span>üìä –ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —è–∑—ã–∫–∞–º</span>
                <span class="arrow">‚ñº</span>
            </button>
            <div class="language-stats" id="languageStats">
                <div class="language-stats-title">
                    üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —è–∑—ã–∫–∞–º
                </div>
                {% if language_stats|length > 0 %}
                <div class="language-chart-container">
                    <div class="pie-chart" id="languagePieChart"></div>
                    <div class="language-legend">
                        {% for stat in language_stats %}
                        <div class="legend-item" data-language="{{ stat.language }}" data-extensions="{{ stat.extensions | join(',') if stat.extensions else '' }}">
                            <div style="display: flex; align-items: center;">
                                {% if stat.icon %}
                                <div class="legend-color has-icon" data-language="{{ stat.language }}">
                                    <img src="{{ '/secret_scanner/' + stat.icon if stat.icon else '' }}" alt="{{ stat.language }}" style="width: 18px; height: 18px;">
                                </div>
                                {% else %}
                                <div class="legend-color no-icon" data-language="{{ stat.language }}" 
                                    style="background-color: {{ stat.color }};">
                                    {{ stat.language[:2].upper() }}
                                </div>
                                {% endif %}
                                <span class="legend-label">{{ stat.language }}</span>
                            </div>
                            <div class="legend-stats">
                                <span class="legend-percentage">{{ stat.percentage }}%</span>
                                <span class="legend-files">{{ stat.count }} —Ñ–∞–π–ª–æ–≤</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% else %}
                <div class="no-files-message">
                    –§–∞–π–ª—ã —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
                </div>
                {% endif %}
            </div>
            {% endif %}
            
            {% if latest_scan.status == 'running' %}
            <div style="text-align: center; margin-top: 1rem;">
                <a href="/secret_scanner/scan/{{ latest_scan.id }}" class="btn btn-primary">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á–µ—Ç</a>
            </div>
            {% elif latest_scan.status == 'completed' %}
            <div style="text-align: center; margin-top: 1rem; display: flex; gap: 1rem; justify-content: center;">
                <a href="/secret_scanner/scan/{{ latest_scan.id }}/results" class="btn btn-primary">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á–µ—Ç</a>
                <a href="/secret_scanner/project/{{ project.name }}/secrets-history" class="btn btn-secondary">üìã –ò—Å—Ç–æ—Ä–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ (beta)</a>
            </div>
            {% endif %}
        </div>
        {% endif %}
        
    <div class="scan-history">
        <h2 class="section-title">üìã –ò—Å—Ç–æ—Ä–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h2>
        {% if scan_stats %}
        <div class="scan-list">
            {% for stat in scan_stats %}
            {% if stat.scan.status == 'completed' %}
            <a href="/secret_scanner/scan/{{ stat.scan.id }}/results" class="scan-item">
            {% elif stat.scan.status == 'running' %}
            <a href="/secret_scanner/scan/{{ stat.scan.id }}" class="scan-item">
            {% elif stat.scan.status == 'failed' or stat.scan.status == 'timeout' %}
            <a href="/secret_scanner/scan/{{ stat.scan.id }}" class="scan-item">
            {% else %}
            <div class="scan-item">
            {% endif %}
                <div class="scan-details">
                    <div class="scan-date">{{ stat.scan.started_at.strftime('%d.%m.%Y %H:%M') }}</div>
                    <div class="scan-meta">
                        <span class="scan-status {{ stat.scan.status }}">
                            {% if stat.scan.status == 'running' %}‚è≥ Running
                            {% elif stat.scan.status == 'completed' %}‚úÖ Completed
                            {% elif stat.scan.status == 'timeout' %}‚è∞ Timeout
                            {% elif stat.scan.status == 'failed' %}‚ùå Failed
                            {% else %}‚ùì Unknown
                            {% endif %}
                        </span>
                        <div>
                            ‚Ä¢ ‚ÑπÔ∏è –ó–∞–ø—É—â–µ–Ω–æ –ø–æ: {{ stat.scan.ref_type }}: {{ stat.scan.ref }}<br>
                            {% if stat.scan.started_by %}‚Ä¢ üëÆ <b><span style="color: #3b82f6;">{{ stat.scan.started_by }}</span></b>{% endif %}
                        </div>
                        <div>
                            {% if stat.scan.repo_commit %}
                            ‚Ä¢ ‚öôÔ∏è Commit: {{ stat.scan.repo_commit }}
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="scan-stats">
                    <div>
                        <span class="confirmed-count">{{ stat.confirmed_count }}</span> secrets
                    </div>
                    {% if stat.scan.files_scanned %}
                    <div class="files-count">–ü—Ä–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ {{ stat.scan.files_scanned }} —Ñ–∞–π–ª–æ–≤</div>
                    {% endif %}
                </div>
                <div class="scan-actions">
                    <form method="post" action="/secret_scanner/scan/{{ stat.scan.id }}/delete" 
                        onsubmit="return confirm('Are you sure you want to delete this scan?')"
                        onclick="event.stopPropagation()">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                </div>
            {% if stat.scan.status == 'completed' or stat.scan.status == 'running' or stat.scan.status == 'failed' or stat.scan.status == 'timeout' %}
            </a>
            {% else %}
            </div>
            {% endif %}
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <h3>ü§∑‚Äç‚ôÇÔ∏è –ù–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
            <p>–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–≤–æ–µ –ø–µ—Ä–≤–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤.</p>
        </div>
        {% endif %}
    </div>
    </div>
    <script src="/secret_scanner/static/js/project.js"></script>
</body>
</html>