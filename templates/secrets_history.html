<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secrets History - {{ project.name }}</title>
    <link rel="stylesheet" href="/static/css/secrets_history.css">
</head>
<body data-project-repo-url="{{ project.repo_url }}" 
      data-latest-commit="{{ latest_scan.repo_commit if latest_scan and latest_scan.repo_commit else '' }}" 
      data-hub-type="{{ HUB_TYPE }}">
    <script type="application/json" id="secrets-data">{{ secrets_json | safe }}</script>
    <script type="application/json" id="secrets-all-data">{{ secrets_all_json | safe }}</script>
    
    <header class="header">
        <a href="/secret_scanner/dashboard" class="logo">
            üîç Secrets Scanner
        </a>
        <nav class="nav-links">
            <a href="/secret_scanner/dashboard">üåê –ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/secret_scanner/multi-scan">üîÑ –ú—É–ª—å—Ç–∏—Å–∫–∞–Ω</a>
            {% if current_user == "admin" %}
            <a href="/secret_scanner/admin">üëë –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</a>
            {% endif %}
            <a href="/secret_scanner/settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
            <a href="/secret_scanner/logout">üîö –í—ã–π—Ç–∏</a>
        </nav>
    </header>
    
    <div class="main-content">
        <div class="left-panel">
            <div class="panel-header">
                <h1 class="project-title">üìã –ò—Å—Ç–æ—Ä–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤: {{ project.name }}</h1>
                
                {% if latest_scan %}
                <div style="margin-bottom: 1rem;">
                    <a href="{{ project.repo_url }}" target="_blank" class="repo-link">
                        üîó {{ project.repo_url }}
                    </a>
                    <br>
                    <span class="commit-info">
                        ‚öôÔ∏è –ê–∫—Ç—É–∞–ª—å–Ω—ã–π –∫–æ–º–º–∏—Ç: <span style="font-weight: bold; color: #3b82f6;">{{ latest_scan.repo_commit if latest_scan.repo_commit else 'Unknown' }}</span>
                    </span>
                </div>
                {% endif %}
                
                <div style="color: #6b7280; font-size: 0.875rem; margin-bottom: 1rem;">
                    üìä –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –∑–∞ –≤—Å–µ –≤—Ä–µ–º—è
                </div>
                
                <div class="stats-summary">
                    <div class="stat-item">
                        <div class="stat-number" id="filteredCount">{{ total_confirmed }}</div>
                        <div class="stat-label">–ü–æ–∫–∞–∑–∞–Ω–æ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="totalCount">{{ total_all }}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</div>
                    </div>
                </div>
                
                <div class="actions-row">
                    <div class="left-actions">
                        <a href="/secret_scanner/project/{{ project.name }}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥</a>
                        <input type="text" id="searchInput" class="search-input" placeholder="üîç –ü–æ–∏—Å–∫..." oninput="applyFilters()">
                        <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: #6b7280;">
                            <input type="checkbox" id="showAllSecrets" onchange="applyFilters()" style="margin: 0;">
                            –ü–æ–∫–∞–∑–∞—Ç—å –Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ
                        </label>
                    </div>
                    <div class="right-actions">
                        <button class="btn btn-info" onclick="toggleFiltersPanel()" id="filtersToggleBtn">üîç –§–∏–ª—å—Ç—Ä—ã</button>
                    </div>
                </div>
            </div>

            <div class="secrets-table-container" id="secretsTableContainer">
                <div id="secretsTable">
                    <!-- Table will be populated by JavaScript -->
                </div>
            </div>

            <div class="pagination-container" id="paginationContainer">
                <div class="pagination-info" id="paginationInfo">
                    <!-- Pagination info will be populated by JavaScript -->
                </div>
                <div class="pagination-controls" id="paginationControls">
                    <!-- Pagination controls will be populated by JavaScript -->
                </div>
                <div class="page-size-selector">
                    <label for="pageSize">–ó–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É:</label>
                    <select id="pageSize" onchange="changePageSize()">
                        <option value="50">50</option>
                        <option value="100" selected>100</option>
                        <option value="200">200</option>
                        <option value="500">500</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="right-panel">
            <div class="panel-header">
                <h3>–î–µ—Ç–∞–ª–∏ —Å–µ–∫—Ä–µ—Ç–∞</h3>
            </div>
            <div class="detail-panel" id="detailPanel">
                <div class="detail-empty">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üëà</div>
                    <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç</h3>
                    <p>–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ª—é–±–æ–π —Å–µ–∫—Ä–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters Panel -->
    <div class="filters-panel" id="filtersPanel">
        <div class="filters-header">
            <h3 class="filters-title">üîç –§–∏–ª—å—Ç—Ä—ã</h3>
            <button class="filters-close" onclick="toggleFiltersPanel()">√ó</button>
        </div>
        <div class="filters-content">
            <div class="filter-group">
                <h4>üìä –°—Ç–∞—Ç—É—Å</h4>
                <div class="checkbox-item">
                    <input type="checkbox" id="status-refuted" value="refuted" onchange="applyFilters()" checked>
                    <label for="status-refuted">‚úÖ Refuted</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="status-resolved" value="resolved" onchange="applyFilters()" checked>
                    <label for="status-resolved">‚ö†Ô∏è Resolved</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="status-active" value="active" onchange="applyFilters()" checked>
                    <label for="status-active">‚ùå Active</label>
                </div>
            </div>

            <div class="filter-group">
                <h4>‚ö†Ô∏è –£—Ä–æ–≤–µ–Ω—å</h4>
                <div class="checkbox-item">
                    <input type="checkbox" id="severity-high" value="High" onchange="applyFilters()" checked>
                    <label for="severity-high">üõë High</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="severity-potential" value="Potential" onchange="applyFilters()" checked>
                    <label for="severity-potential">üîò Potential</label>
                </div>
            </div>

            <div class="filter-group">
                <h4>üè∑Ô∏è –¢–∏–ø</h4>
                <div id="typeFilters">
                    <!-- Type filters will be populated by JavaScript -->
                </div>
            </div>
        </div>
        <div class="filters-actions">
            <button class="clear-filters-btn" onclick="clearAllFilters()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã</button>
        </div>
    </div>
    <script src="/static/js/secrets_history.js"></script>
</body>
</html>