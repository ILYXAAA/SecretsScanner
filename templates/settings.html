<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Secrets Scanner</title>
    <link rel="stylesheet" href="/static/css/settings.css">
</head>
<body data-original-rules="{{ (current_rules_content or '') | e }}"
      data-original-fp-rules="{{ (current_fp_rules_content or '') | e }}"
      data-original-extensions="{{ (current_excluded_extensions_content or '') | e }}"
      data-original-files="{{ (current_excluded_files_content or '') | e }}"
      data-is-sqlite="{{ is_sqlite | tojson }}">
    <header class="header">
        <a href="/secret_scanner/dashboard" class="logo">
            üîç Secrets Scanner
        </a>
        <nav class="nav-links">
            <a href="/secret_scanner/dashboard">üåê –ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/secret_scanner/multi-scan">üîÑ –ú—É–ª—å—Ç–∏—Å–∫–∞–Ω</a>
            {% if current_user == "admin" %}
            <a href="/secret_scanner/admin">üëë –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</a>
            {% endif %}
            <a href="/secret_scanner/settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
            <a href="/secret_scanner/logout">üîö –í—ã–π—Ç–∏</a>
        </nav>
    </header>
    
    <div class="container">
        <h1 class="page-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
        {% if 'error=microservice_unavailable' in rules_info %}
            <div class="alert alert-error">Microservice is unavailable. Please check if the scanning service is running.</div>
        {% endif %}

        {% if request.url.query %}
            {% if 'success=token_updated' in request.url.query %}
            <div class="alert alert-success">PAT token updated successfully!</div>
            {% elif 'success=rules_updated' in request.url.query %}
            <div class="alert alert-success">Rules updated successfully!</div>
            {% elif 'success=fp_rules_updated' in request.url.query %}
            <div class="alert alert-success">False-Positive rules updated successfully!</div>
            {% elif 'success=excluded_extensions_updated' in request.url.query %}
            <div class="alert alert-success">Excluded extensions updated successfully!</div>
            {% elif 'success=excluded_files_updated' in request.url.query %}
            <div class="alert alert-success">Excluded files updated successfully!</div>
            {% elif 'success=backup_created' in request.url.query %}
            <div class="alert alert-success">Database backup created successfully!</div>
            {% elif 'error=token_update_failed' in request.url.query %}
            <div class="alert alert-error">Failed to update PAT token.</div>
            {% elif 'error=empty_content' in request.url.query %}
            <div class="alert alert-error">Configuration content cannot be empty.</div>
            {% elif 'error=backup_failed' in request.url.query %}
            <div class="alert alert-error">Failed to create database backup.</div>
            {% elif 'error=microservice_unavailable' in rules_info %}
                {% if not microservice_available or (rules_info and rules_info.get('error') == 'microservice_unavailable') %}
                    <div class="alert alert-error">Microservice is unavailable. Please check if the scanning service is running.</div>
                {% endif %}
            {% elif 'error=' in request.url.query %}
            <div class="alert alert-error">{{ request.url.query.split('error=')[1].split('&')[0] | urldecode }}</div>
            {% endif %}
            {% elif 'success=password_changed' in request.url.query %}
            <div class="alert alert-success">–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω!</div>
            {% elif 'error=password_change_failed' in request.url.query %}
            <div class="alert alert-error">–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å.</div>
            {% elif 'error=password_mismatch' in request.url.query %}
            <div class="alert alert-error">–ù–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç.</div>
            {% elif 'success=api_key_updated' in request.url.query %}
            <div class="alert alert-success">API –∫–ª—é—á —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!</div>
            {% elif 'error=api_key_update_failed' in request.url.query %}
            <div class="alert alert-error">–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å API –∫–ª—é—á.</div>
        {% endif %}
        
        <!-- Combined Configuration Section with Tabs -->
        <div class="settings-section">
            <h2 class="section-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .yml —Ñ–∞–π–ª–æ–≤ (–ø—Ä–∞–≤–∏–ª —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)</h2>
            <p style="color: #666; margin-bottom: 2rem;">
                –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
            </p>
            
            <div class="config-tabs">
                <button class="config-tab active" data-tab="rules">
                    üõ°Ô∏è Rules Configuration
                    <span class="unsaved-indicator" id="rules-unsaved" style="display: none;"></span>
                </button>
                <button class="config-tab" data-tab="fp-rules">
                    üö´ False-Positive
                    <span class="unsaved-indicator" id="fp-rules-unsaved" style="display: none;"></span>
                </button>
                <button class="config-tab" data-tab="extensions">
                    üß© Excluded Extensions
                    <span class="unsaved-indicator" id="extensions-unsaved" style="display: none;"></span>
                </button>
                <!-- <button class="config-tab" data-tab="files">
                    üóÇÔ∏è Excluded Files
                    <span class="unsaved-indicator" id="files-unsaved" style="display: none;"></span>
                </button> -->
            </div>

            <div class="tab-content-wrapper">
                <!-- Rules Configuration Tab -->
                <div class="config-content active" id="rules-content">
                    <div class="config-header">
                        <div class="config-description">
                            <p style="color: #666; margin-bottom: 1rem;">
                                –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∞–≤–∏–ª YAML –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —Å–µ–∫—Ä–µ—Ç–æ–≤.
                            </p>
                            <p style="color: #666; margin-bottom: 1rem;">
                                üõë –ü–∞—Ä–∞–º–µ—Ç—Ä <span style="color: #a73b28;">severity</span> –º–æ–∂–Ω–æ –≤—ã—Å—Ç–∞–≤–ª—è—Ç—å –ª—é–±–æ–π, —Ç.–∫. –µ–≥–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–æ–¥–µ–ª—å-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–µ.
                            </p>
                            <p style="color: #666; margin-bottom: 1rem;">
                                üè∑Ô∏è –ü–∞—Ä–∞–º–µ—Ç—Ä <span style="color: #28a745;">message</span> - —ç—Ç–æ —Ç–∏–ø —Å–µ–∫—Ä–µ—Ç–∞ (Type), –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ä—è–¥–æ–º —Å —Å–µ–∫—Ä–µ—Ç–æ–º –≤ –æ—Ç—á–µ—Ç–∞—Ö.
                            </p>
                        </div>
                        <div class="config-stats">
                            {% if rules_info %}
                            <div class="config-info">
                                <p><strong>–°—Ç–∞—Ç—É—Å —Ñ–∞–π–ª–∞:</strong></p>
                                {% if rules_info.exists %}
                                <p>üìÅ –†–∞–∑–º–µ—Ä: {{ "%.1f"|format(rules_info.size / 1024) }} KB</p>
                                <p>üìÖ –ò–∑–º–µ–Ω–µ–Ω–æ: {{ rules_info.modified | strftime if rules_info.modified else 'Unknown' }}</p>
                                {% else %}
                                <p style="color: #ff6b6b;">‚ùå –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ª–∏–±–æ —Ñ–∞–π–ª–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</p>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <form method="post" action="/secret_scanner/settings/update-rules" id="rulesForm">
                        <div class="form-group">
                            <label for="rules_content">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –ø—Ä–∞–≤–∏–ª (YAML):</label>
                            <textarea 
                                id="rules_content" 
                                name="rules_content" 
                                required
                                class="config-textarea"
                                placeholder='# –í–≤–µ–¥–∏—Ç–µ —Å–≤–æ—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∞–≤–∏–ª YAML –∑–¥–µ—Å—å
# Example:
- id: privateKey.key
  message: Private key
  pattern: "\\s*-----\\s*BEGIN*PRIVATE KEY*\\s*-----"
  severity: HIGH'>{{ current_rules_content or "" }}</textarea>
                        </div>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <button type="submit" class="btn btn-success" id="updateRulesBtn">
                                üíæ –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetContent('rules')">
                                üîÑ –°–±—Ä–æ—Å–∏—Ç—å –¥–æ —Ç–µ–∫—É—â–∏—Ö
                            </button>
                        </div>
                    </form>
                </div>

                <!-- False-Positive Rules Tab -->
                <div class="config-content" id="fp-rules-content">
                    <div class="config-header">
                        <div class="config-description">
                            <p style="color: #666; margin-bottom: 1rem;">
                                –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏. 
                            </p>
                            <p style="color: #666; margin-bottom: 1rem;">
                                üìÑ –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –∏–∑ .yml —Ñ–∞–π–ª–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ <span style="color: #28a745;">context</span> –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞ - –¥–∞–Ω–Ω—ã–π —Å–µ–∫—Ä–µ—Ç –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏.
                            </p>
                            <p style="color: #666; margin-bottom: 1rem;">
                                ‚ö†Ô∏è –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É, –≤ –∫–æ—Ç–æ—Ä–æ–π —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –¥–≤–æ–π–Ω–∞—è –∫–∞–≤—ã—á–∫–∞ (<span style="color: #43a93c; font-size:medium; font-weight: bold;">"</span>), —Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É –≤ –æ–¥–∏–Ω–∞—Ä–Ω—ã—Ö: <br>
                                –ü—Ä–∏–º–µ—Ä: <b>- 'tes<span style="color: #43a93c; font-weight: bolder;">"</span>t'</b>
                            </p>
                        </div>
                        <div class="config-stats">
                            {% if fp_rules_info %}
                            <div class="config-info">
                                <p><strong>–°—Ç–∞—Ç—É—Å —Ñ–∞–π–ª–∞:</strong></p>
                                {% if fp_rules_info.exists %}
                                <p>üìÅ –†–∞–∑–º–µ—Ä: {{ "%.1f"|format(fp_rules_info.size / 1024) }} KB</p>
                                <p>üìÖ –ò–∑–º–µ–Ω–µ–Ω–æ: {{ fp_rules_info.modified | strftime if fp_rules_info.modified else 'Unknown' }}</p>
                                {% else %}
                                <p style="color: #ff6b6b;">‚ùå –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ª–∏–±–æ —Ñ–∞–π–ª–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</p>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <form method="post" action="/secret_scanner/settings/update-fp-rules" id="fpRulesForm">
                        <div class="form-group">
                            <label for="fp_rules_content">False-Positive Rules Content (YAML):</label>
                            <textarea 
                                id="fp_rules_content" 
                                name="fp_rules_content" 
                                required
                                class="config-textarea"
                                placeholder='# –í–≤–µ–¥–∏—Ç–µ –∑–¥–µ—Å—å —Å–≤–æ—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∞–≤–∏–ª –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π
# Example:
false_positive:
  - "token cancellationtoken"
  - "sha512"
  - "sha256"
  - "password = null"'>{{ current_fp_rules_content or "" }}</textarea>
                        </div>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <button type="submit" class="btn btn-success" id="updateFpRulesBtn">
                                üíæ –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetContent('fp_rules')">
                                üîÑ –°–±—Ä–æ—Å–∏—Ç—å –¥–æ —Ç–µ–∫—É—â–∏—Ö
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Excluded Extensions Tab -->
                <div class="config-content" id="extensions-content">
                    <div class="config-header">
                        <div class="config-description">
                            <p style="color: #666; margin-bottom: 1rem;">
                                üö´ –§–∞–π–ª—ã –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –∏–∑ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –µ—Å–ª–∏ –∏—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –æ–¥–Ω–∏–º –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤ –≤ <span style="color: #df224e;">excluded_extensions.yml</span>
                            </p>
                        </div>
                        <div class="config-stats">
                            {% if excluded_extensions_info %}
                            <div class="config-info">
                                <p><strong>–°—Ç–∞—Ç—É—Å —Ñ–∞–π–ª–∞:</strong></p>
                                {% if excluded_extensions_info.exists %}
                                <p>üìÅ –†–∞–∑–º–µ—Ä: {{ "%.1f"|format(excluded_extensions_info.size / 1024) }} KB</p>
                                <p>üìÖ –ò–∑–º–µ–Ω–µ–Ω–æ: {{ excluded_extensions_info.modified | strftime if excluded_extensions_info.modified else 'Unknown' }}</p>
                                {% else %}
                                <p style="color: #ff6b6b;">‚ùå –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ª–∏–±–æ —Ñ–∞–π–ª–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</p>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <form method="post" action="/secret_scanner/settings/update-excluded-extensions" id="excludedExtensionsForm">
                        <div class="form-group">
                            <label for="excluded_extensions_content">Excluded Extensions Content (YAML):</label>
                            <textarea 
                                id="excluded_extensions_content" 
                                name="excluded_extensions_content" 
                                required
                                class="config-textarea"
                                placeholder="# –í–≤–µ–¥–∏—Ç–µ —Å–≤–æ—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏—Å–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –∑–¥–µ—Å—å
# Example:
excluded_extensions:
- png
- jpg
- jpeg">{{ current_excluded_extensions_content or "" }}</textarea>
                        </div>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <button type="submit" class="btn btn-success" id="updateExtensionsBtn">
                                üíæ –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetContent('extensions')">
                                üîÑ –°–±—Ä–æ—Å–∏—Ç—å –¥–æ —Ç–µ–∫—É—â–∏—Ö
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Excluded Files Tab -->
                <div class="config-content" id="files-content">
                    <div class="config-header">
                        <div class="config-description">
                            <p style="color: #666; margin-bottom: 1rem;">
                                –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–∞–π–ª—ã, —á—Ç–æ–±—ã –æ–Ω–∏ –∏—Å–∫–ª—é—á–∞–ª–∏—Å—å –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏.
                            </p>
                        </div>
                        <div class="config-stats">
                            {% if excluded_files_info %}
                            <div class="config-info">
                                <p><strong>–°—Ç–∞—Ç—É—Å —Ñ–∞–π–ª–∞:</strong></p>
                                {% if excluded_files_info.exists %}
                                <p>üìÅ –†–∞–∑–º–µ—Ä: {{ "%.1f"|format(excluded_files_info.size / 1024) }} KB</p>
                                <p>üìÖ –ò–∑–º–µ–Ω–µ–Ω–æ: {{ excluded_files_info.modified | strftime if excluded_files_info.modified else 'Unknown' }}</p>
                                {% else %}
                                <p style="color: #ff6b6b;">‚ùå –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ª–∏–±–æ —Ñ–∞–π–ª–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</p>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <form method="post" action="/secret_scanner/settings/update-excluded-files" id="excludedFilesForm">
                        <div class="form-group">
                            <label for="excluded_files_content">Excluded Files Content (YAML):</label>
                            <textarea 
                                id="excluded_files_content" 
                                name="excluded_files_content" 
                                required
                                class="config-textarea"
                                placeholder="# –í–≤–µ–¥–∏—Ç–µ –∑–¥–µ—Å—å —Å–≤–æ—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ñ–∞–π–ª–æ–≤-–∏—Å–∫–ª—é—á–µ–Ω–∏–π
# Example:
excluded_files:
- yarn.lock
- requirements.txt
- CMakeLists.txt">{{ current_excluded_files_content or "" }}</textarea>
                        </div>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <button type="submit" class="btn btn-success" id="updateFilesBtn">
                                üíæ –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetContent('files')">
                                üîÑ –°–±—Ä–æ—Å–∏—Ç—å –¥–æ —Ç–µ–∫—É—â–∏—Ö
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="settings-section">
            <h2 class="section-title">üîë Security</h2>
            <p style="color: #666; margin-bottom: 2rem;">
                –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤, –∫–ª—é—á–µ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∞–∫–∫–∞—É–Ω—Ç–∞.
            </p>
            
            <div class="config-tabs">
                {% if current_user == "admin" %}
                <button class="config-tab active" data-tab="api-key">
                    üîê API Key
                </button>
                <button class="config-tab" data-tab="password-change">
                    üîí –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
                </button>
                <button class="config-tab" data-tab="pat-token">
                    üîë PAT Token
                </button>
                {% else %}
                <button class="config-tab active" data-tab="password-change">
                    üîí –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
                </button>
                {% endif %}
            </div>

            <div class="tab-content-wrapper">
                <!-- API Key Tab -->
                 {% if current_user == "admin" %}
                <div class="config-content active" id="api-key-content">
                    <div class="config-header">
                        <div class="config-description">
                            <p style="color: #666; margin-bottom: 1rem;">
                                API –∫–ª—é—á –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—É —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.
                            </p>
                            <p style="color: #666; margin-bottom: 1rem;">
                                ‚ö†Ô∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–ª—é—á–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ —Å –Ω–æ–≤—ã–º –∫–ª—é—á–æ–º.
                            </p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>–¢–µ–∫—É—â–∏–π API –∫–ª—é—á:</label>
                        <div class="current-token">{{ current_api_key }}</div>
                    </div>
                    
                    <form method="post" action="/secret_scanner/settings/update-api-key">
                        <div class="form-group">
                            <label for="api_key">–ù–æ–≤—ã–π API –∫–ª—é—á:</label>
                            <input type="password" id="api_key" name="api_key" placeholder="your_new_api_key_here" required>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            üíæ –û–±–Ω–æ–≤–∏—Ç—å API –∫–ª—é—á
                        </button>
                    </form>
                </div>
                {% endif %}

                <!-- Password Change Tab -->
                <div class="config-content" id="password-change-content">
                    <div class="config-header">
                        <div class="config-description">
                            <p style="color: #666; margin-bottom: 1rem;">
                                –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞. –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤.
                            </p>
                        </div>
                    </div>
                    
                    <form method="post" action="/secret_scanner/settings/change-password" id="passwordChangeForm">
                        <div class="form-group">
                            <label for="current_password">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å:</label>
                            <input type="password" id="current_password" name="current_password" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="new_password">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label>
                            <input type="password" id="new_password" name="new_password" minlength="8" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirm_password">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label>
                            <input type="password" id="confirm_password" name="confirm_password" minlength="8" required>
                        </div>
                        
                        <button type="submit" class="btn btn-primary" id="changePasswordBtn">
                            üîê –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                        </button>
                    </form>
                </div>

                <!-- PAT Token Tab -->
                 {% if current_user == "admin" %}
                <div class="config-content" id="pat-token-content">
                    <div class="config-header">
                        <div class="config-description">
                            <p style="color: #666; margin-bottom: 1rem;">
                                PAT-—Ç–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Azure, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–º –¥–ª—è —Ä–µ–∑–æ–ª–≤–∞ –∫–æ–º–º–∏—Ç–æ–≤ –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤.
                            </p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>–¢–µ–∫—É—â–∏–π —Ç–æ–∫–µ–Ω:</label>
                        <div class="current-token">{{ current_token }}</div>
                    </div>
                    
                    <form method="post" action="/secret_scanner/settings/update-token">
                        <div class="form-group">
                            <label for="token">–ù–æ–≤—ã–π PAT –¢–æ–∫–µ–Ω:</label>
                            <input type="password" id="token" name="token" placeholder="aboba_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" required>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            üíæ –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω
                        </button>
                    </form>
                </div>
                {% endif %}
            </div>
        </div>
        
       <!-- Database Backup Section -->
        {% if current_user == "admin" %}
        <div class="settings-section">
            <h2 class="section-title">üíæ Database Backup Management</h2>
            {% if is_sqlite %}
            <p style="color: #666; margin-bottom: 1rem;">
                –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞.
            </p>
            
            <div class="backup-grid">
                <div class="backup-stat">
                    <h3 id="backup-count">-</h3>
                    <p>–î–æ—Å—Ç—É–ø–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤</p>
                </div>
                <div class="backup-stat">
                    <h3 id="retention-days">{{ BACKUP_RETENTION_DAYS if BACKUP_RETENTION_DAYS is defined else 7 }}</h3>
                    <p>–•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –¥–Ω—è—Ö</p>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                <button type="button" class="btn btn-primary" onclick="createBackup()" id="createBackupBtn">
                    üíæ –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –ë–î
                </button>
                <button type="button" class="btn btn-info" onclick="refreshBackups()" id="refreshBtn">
                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
                </button>
            </div>
            
            <div id="backup-list-container">
                <h3 style="margin-bottom: 0.5rem;">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –±—ç–∫–∞–ø—ã:</h3>
                <div class="backup-list" id="backup-list">
                    <div style="padding: 2rem; text-align: center; color: #666;">
                        <div class="spinner"></div>
                        –ó–∞–≥—Ä—É–∑–∫–∞ –±—ç–∫–∞–ø–æ–≤...
                    </div>
                </div>
            </div>
            {% else %}
            <div class="alert alert-error">
                ‚ö†Ô∏è –ë—ç–∫–∞–ø—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è SQLite. 
                –¢–µ–∫—É—â–∞—è –ë–î: {{ db_type }}
            </div>
            <p style="color: #666; margin-bottom: 1rem;">
                –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–æ–≤ PostgreSQL –∏–ª–∏ MySQL –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
            </p>
            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; border: 1px solid #e1e5e9; font-family: monospace; font-size: 0.9rem;">
                <strong>PostgreSQL:</strong> pg_dump database_name > backup.sql<br>
                <strong>MySQL:</strong> mysqldump database_name > backup.sql
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>
    <script src="/static/js/settings.js"></script>
</body>
</html>