<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Secrets Scanner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #e2e7ec;
            /* background: #f8f9fa;  */
            color: #333;
        }
        
        .header {
            background: white;
            padding: 1rem 2rem;
            border-bottom: 1px solid #e1e5e9;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            text-decoration: none;
            cursor: pointer;
        }
        
        .nav-links {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .nav-links a {
            color: #666;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        
        .nav-links a:hover {
            background: #f1f3f4;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .page-title {
            font-size: 2rem;
            font-weight: 600;
            color: #333;
        }
        
        .search-bar {
            flex: 1;
            max-width: 400px;
            margin: 0 2rem;
        }
        
        .search-bar input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .search-bar input:focus {
            outline: none;
            border-color: #28a745;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-1px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3ccf4e, #29b948); /* –ó–µ–ª—ë–Ω–∞—è */
            color: white;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            padding: 10px 18px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #2ebc3f, #219837);
        }

    
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .projects-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .project-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 1px solid #e1e5e9;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .project-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        
        .project-main {
            flex: 1;
        }
        
        .project-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .project-url {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            word-break: break-all;
        }
        
        .project-meta {
            color: #888;
            font-size: 0.85rem;
        }
        
        .project-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }
        
        .btn-icon {
            padding: 0.5rem;
            min-width: auto;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 2rem;
        }
        
        .pagination a {
            padding: 0.5rem 1rem;
            text-decoration: none;
            color: #666;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        
        .pagination a:hover {
            background: #f1f3f4;
        }
        
        .pagination .current {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }
        
        .add-project-form {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 1px solid #e1e5e9;
            margin-bottom: 2rem;
            display: none;
        }
        
        .add-project-form.show {
            display: block;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }
        
        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #28a745;
        }
        
        .form-actions {
            display: flex;
            gap: 1rem;
        }
        
        .alert {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }
        
        .empty-state h3 {
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .edit-project-form {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 1px solid #e1e5e9;
            margin-bottom: 2rem;
            display: none;
        }
        
        .edit-project-form.show {
            display: block;
        }
    </style>
</head>
<body>
    <header class="header">
        <a href="/dashboard" class="logo">
            üîç Secrets Scanner
        </a>
        <nav class="nav-links">
            <a href="/dashboard">üåê –ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
            <a href="/logout">üîö –í—ã–π—Ç–∏</a>
        </nav>
    </header>
    
    <div class="container">
        <div class="page-header">
            <h1 class="page-title">üóÇÔ∏è –ü—Ä–æ–µ–∫—Ç—ã</h1>
            <div class="search-bar">
                <form method="get">
                    <input type="text" name="search" placeholder="–ü–æ–∏—Å–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤..." value="{{ search }}">
                    <input type="hidden" name="page" value="1">
                </form>
            </div>
            <button class="btn btn-primary" onclick="toggleAddForm()">
                ‚ûï –ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
            </button>
        </div>
        
        {% if request.url.query %}
            {% if 'success=project_added' in request.url.query %}
            <div class="alert alert-success">–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω</div>
            {% elif 'success=project_updated' in request.url.query %}
            <div class="alert alert-success">–î–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã</div>
            {% elif 'success=project_deleted' in request.url.query %}
            <div class="alert alert-success">–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω</div>
            {% elif 'error=project_exists' in request.url.query %}
            <div class="alert alert-error">–ü—Ä–æ–µ–∫—Ç —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</div>
            {% elif 'error=empty_project_name' in request.url.query %}
            <div class="alert alert-error">–ò–º—è –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º</div>
            {% elif 'error=invalid_project_name' in request.url.query %}
            <div class="alert alert-error">–ò–º—è –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã</div>
            {% elif 'error=project_not_found' in request.url.query %}
            <div class="alert alert-error">–ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω</div>
            {% elif 'error=unexpected_error' in request.url.query %}
            <div class="alert alert-error">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞</div>
            {% elif 'error=' in request.url.query %}
            <div class="alert alert-error">{{ request.url.query.split('error=')[1] | urldecode }}</div>
            {% endif %}
        {% endif %}
        
        <div class="add-project-form" id="addProjectForm">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</h3>
            <form method="post" action="/projects/add">
                <div class="form-group">
                    <label for="project_name">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</label>
                    <input type="text" id="project_name" name="project_name" required 
                           pattern="[a-zA-Z0-9._\-\s]+" 
                           title="–î–æ–ø—É—Å—Ç–∏–º—ã –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, —Ç–æ—á–∫–∏, –¥–µ—Ñ–∏—Å—ã, –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–±–µ–ª—ã">
                </div>
                <div class="form-group">
                    <label for="repo_url">–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π</label>
                    {% if HUB_TYPE == "Azure" %}
                    <input type="url" id="repo_url" name="repo_url" 
                           placeholder="http://server/Collection/Project/_git/Repository" required>
                    <small style="color: #666; font-size: 0.85rem;">
                        –§–æ—Ä–º–∞—Ç –¥–ª—è Azure DevOps: http://server/collection/project/_git/repository<br>
                        –∏–ª–∏ http://server/collection/_git/repository
                    </small>
                    {% else %}
                    <input type="url" id="repo_url" name="repo_url" 
                           placeholder="https://github.com/user/repo" required>
                    <small style="color: #666; font-size: 0.85rem;">
                        –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è GitHub, GitLab, Bitbucket –∏ –¥—Ä—É–≥–∏–µ Git-—Ö–æ—Å—Ç–∏–Ω–≥–∏
                    </small>
                    {% endif %}
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
                    <button type="button" class="btn btn-secondary" onclick="toggleAddForm()">–ù–∞–∑–∞–¥</button>
                </div>
            </form>
        </div>

        <div class="edit-project-form" id="editProjectForm">
            <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</h3>
            <form method="post" action="/projects/update" id="editForm">
                <input type="hidden" id="edit_project_id" name="project_id">
                <div class="form-group">
                    <label for="edit_project_name">–ò–º—è –ø—Ä–æ–µ–∫—Ç–∞</label>
                    <input type="text" id="edit_project_name" name="project_name" required
                           pattern="[a-zA-Z0-9._\-\s]+" 
                           title="–î–æ–ø—É—Å—Ç–∏–º—ã –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, —Ç–æ—á–∫–∏, –¥–µ—Ñ–∏—Å—ã, –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–±–µ–ª—ã">
                </div>
                <div class="form-group">
                    <label for="edit_repo_url">–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π</label>
                    <input type="url" id="edit_repo_url" name="repo_url" required>
                    {% if HUB_TYPE == "Azure" %}
                    <small style="color: #666; font-size: 0.85rem;">
                        –§–æ—Ä–º–∞—Ç –¥–ª—è Azure DevOps: http://server/collection/project/_git/repository<br>
                        –∏–ª–∏ http://server/collection/_git/repository
                    </small>
                    {% else %}
                    <small style="color: #666; font-size: 0.85rem;">
                        –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è GitHub, GitLab, Bitbucket –∏ –¥—Ä—É–≥–∏–µ Git-—Ö–æ—Å—Ç–∏–Ω–≥–∏
                    </small>
                    {% endif %}
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">–û–±–Ω–æ–≤–∏—Ç—å</button>
                    <button type="button" class="btn btn-secondary" onclick="toggleEditForm()">–ù–∞–∑–∞–¥</button>
                </div>
            </form>
        </div>
        
        {% if projects %}
        <div class="projects-list">
            {% for project in projects %}
            <a href="/project/{{ project.name }}" class="project-card">
                <div class="project-main">
                    <div class="project-name">{{ project.name }}</div>
                    <div class="project-url">{{ project.repo_url }}</div>
                    <div class="project-meta">
                        –°–æ–∑–¥–∞–Ω: {{ project.created_at.strftime('%Y-%m-%d %H:%M') }}
                    </div>
                </div>
                <div class="project-actions" onclick="event.preventDefault(); event.stopPropagation();">
                    <button class="btn btn-warning btn-sm btn-icon" onclick="editProject({{ project.id }}, '{{ project.name }}', '{{ project.repo_url }}')" title="Edit">
                        ‚úèÔ∏è
                    </button>
                    <button class="btn btn-danger btn-sm btn-icon" title="Delete"
                            onclick="deleteProject({{ project.id }})">
                        üóëÔ∏è
                    </button>
                </div>
            </a>
            {% endfor %}
        </div>
        
        {% if total_pages > 1 %}
        <div class="pagination">
            {% if has_prev %}
            <a href="?page={{ current_page - 1 }}&search={{ search }}">&larr; Previous</a>
            {% endif %}
            
            {% for page_num in range(1, total_pages + 1) %}
                {% if page_num == current_page %}
                <a href="#" class="current">{{ page_num }}</a>
                {% else %}
                <a href="?page={{ page_num }}&search={{ search }}">{{ page_num }}</a>
                {% endif %}
            {% endfor %}
            
            {% if has_next %}
            <a href="?page={{ current_page + 1 }}&search={{ search }}">Next &rarr;</a>
            {% endif %}
        </div>
        {% endif %}
        
        {% else %}
        <div class="empty-state">
            <h3>ü§∑‚Äç‚ôÇÔ∏è –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
            <p>{% if search %}–ù–∏ –æ–¥–∏–Ω –ø—Ä–æ–µ–∫—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–∞—à–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º –ø–æ–∏—Å–∫–∞.{% else %}Start by adding your first project.{% endif %}</p>
        </div>
        {% endif %}
    </div>
    
    <script>
        function toggleAddForm() {
            const form = document.getElementById('addProjectForm');
            const editForm = document.getElementById('editProjectForm');
            editForm.classList.remove('show');
            form.classList.toggle('show');
        }

        function toggleEditForm() {
            const form = document.getElementById('editProjectForm');
            form.classList.toggle('show');
        }

        function editProject(id, name, repoUrl) {
            document.getElementById('edit_project_id').value = id;
            document.getElementById('edit_project_name').value = name;
            document.getElementById('edit_repo_url').value = repoUrl;
            
            const addForm = document.getElementById('addProjectForm');
            addForm.classList.remove('show');
            
            const editForm = document.getElementById('editProjectForm');
            editForm.classList.add('show');
        }

        function deleteProject(id) {
        const confirmed = confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –∏ –≤—Å–µ –µ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è?');
        if (!confirmed) return;

        fetch(`/projects/${id}/delete`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
        })
        .then(response => {
            if (response.ok) {
                // –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ —É–¥–∞–ª–∏–º —ç–ª–µ–º–µ–Ω—Ç –∏–∑ DOM
                location.reload();
            } else {
                alert('Failed to delete project.');
            }
        })
        .catch(error => {
            console.error('Error deleting project:', error);
            alert('Something went wrong.');
        });
    }

        
        // Auto-submit search form on input
        const searchInput = document.querySelector('input[name="search"]');
        searchInput.addEventListener('input', function() {
            setTimeout(() => {
                this.closest('form').submit();
            }, 500);
        });
    </script>
</body>
</html>