<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - Secrets Scanner</title>
    <link rel="stylesheet" href="/secret_scanner/static/css/base_header.css">
    <link rel="stylesheet" href="/secret_scanner/static/css/stats_dashboard.css">
    <link rel="icon" type="image/x-icon" href="/secret_scanner/favicon.ico">
</head>
<body>
    {% from "components/base_header.html" import header %}
    {{ header('stats-dashboard', current_user) }}

    <div class="container">
        <div class="page-header">
            <h1 class="page-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤</h1>
            <div class="page-subtitle">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–º —Å–µ–∫—Ä–µ—Ç–∞–º</div>
        </div>

        <!-- KPI Cards -->
        <div class="kpi-grid" id="kpiGrid">
            <div class="kpi-card kpi-primary">
                <div class="kpi-icon">üü¢</div>
                <div class="kpi-content">
                    <div class="kpi-value" id="kpiActiveConfirmed">-</div>
                    <div class="kpi-label">–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã</div>
                    <div class="kpi-sublabel">–í—Å–µ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤</div>
                </div>
            </div>

            <div class="kpi-card kpi-warning">
                <div class="kpi-icon">üìÖ</div>
                <div class="kpi-content">
                    <div class="kpi-value" id="kpiNew24h">-</div>
                    <div class="kpi-label">–ù–æ–≤—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ (24—á)</div>
                    <div class="kpi-sublabel">–ù–∞–π–¥–µ–Ω–æ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—É—Ç–∫–∏</div>
                </div>
            </div>

            <div class="kpi-card kpi-info">
                <div class="kpi-icon">üìÖ</div>
                <div class="kpi-content">
                    <div class="kpi-value" id="kpiNew7d">-</div>
                    <div class="kpi-label">–ù–æ–≤—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ (7–¥)</div>
                    <div class="kpi-sublabel">–ù–∞–π–¥–µ–Ω–æ –∑–∞ –Ω–µ–¥–µ–ª—é</div>
                </div>
            </div>

            <div class="kpi-card kpi-success">
                <div class="kpi-icon">üõ°Ô∏è</div>
                <div class="kpi-content">
                    <div class="kpi-value" id="kpiNoStatus">-</div>
                    <div class="kpi-label">–¢—Ä–µ–±—É—é—Ç —Ä–∞–∑–º–µ—Ç–∫–∏</div>
                    <div class="kpi-sublabel">–°–µ–∫—Ä–µ—Ç—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º No Status</div>
                </div>
            </div>
        </div>

        <!-- Stats Tabs -->
        <div class="stats-tabs">
            <button class="stats-tab active" data-tab="overview">
                üìä –û–±–∑–æ—Ä
            </button>
            <button class="stats-tab" data-tab="secrets">
                üîê –°–µ–∫—Ä–µ—Ç—ã
            </button>
            <button class="stats-tab" data-tab="scans">
                üîÑ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            </button>
            <button class="stats-tab" data-tab="analytics">
                ü§ñ ML-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä
            </button>
        </div>

        <div class="tab-content-wrapper">
            <!-- Overview Tab -->
            <div class="stats-tab-content active" id="overview-content">
                <!-- Trends Chart -->
                <div class="chart-section">
                    <div class="section-header">
                        <h2 class="section-title">üìà –¢—Ä–µ–Ω–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤</h2>
                        <div class="period-selector">
                            <button class="period-btn active" data-period="30">30 –¥–Ω–µ–π</button>
                            <button class="period-btn" data-period="90">90 –¥–Ω–µ–π</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="trendsChart"></canvas>
                    </div>
                    <div class="chart-legend" id="trendsLegend">
                        <div class="legend-item">
                            <span class="legend-color" style="background: #dc3545;"></span>
                            <span class="legend-label">High</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #ffc107;"></span>
                            <span class="legend-label">Potential</span>
                        </div>
                    </div>
                </div>

                <!-- Status Distribution Pie Chart -->
                <div class="chart-section">
                    <div class="section-header">
                        <h2 class="section-title">üìä –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–µ–∫—Ä–µ—Ç–æ–≤</h2>
                    </div>
                    <div class="two-column-grid">
                        <div class="chart-container-medium">
                            <canvas id="statusChart"></canvas>
                        </div>
                        <div class="status-stats" id="statusStats">
                            <div class="stat-item">
                                <div class="stat-label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ (Confirmed)</div>
                                <div class="stat-value">
                                    <span id="confirmedCount">-</span>
                                    <span class="stat-pct">(<span id="confirmedPct">-</span>%)</span>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–õ–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è (Refuted)</div>
                                <div class="stat-value">
                                    <span id="refutedCount">-</span>
                                    <span class="stat-pct">(<span id="refutedPct">-</span>%)</span>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–¢—Ä–µ–±—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ (No status)</div>
                                <div class="stat-value">
                                    <span id="noStatusCount">-</span>
                                    <span class="stat-pct">(<span id="noStatusPct">-</span>%)</span>
                                </div>
                            </div>
                            <div class="stat-item stat-highlight">
                                <div class="stat-label">False Positive Rate</div>
                                <div class="stat-value-large">
                                    <span id="fpRate">-</span>%
                                </div>
                                <div class="stat-sublabel">–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ FP –∫ —Ä–µ–∞–ª—å–Ω—ã–º —Å–µ–∫—Ä–µ—Ç–∞–º</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Secrets Tab -->
            <div class="stats-tab-content" id="secrets-content">
                <!-- Two Column Layout -->
                <div class="two-column-grid">
                    <!-- Top Projects Table -->
                    <div class="chart-section">
                        <div class="section-header">
                            <h2 class="section-title">üö® –¢–æ–ø-5 –ø—Ä–æ–µ–∫—Ç–æ–≤</h2>
                        </div>
                        <div class="table-container">
                            <table class="top-projects-table" id="topProjectsTable">
                                <thead>
                                    <tr>
                                        <th>‚Ññ</th>
                                        <th>–ü—Ä–æ–µ–∫—Ç</th>
                                        <th>–°–µ–∫—Ä–µ—Ç–æ–≤</th>
                                    </tr>
                                </thead>
                                <tbody id="topProjectsBody">
                                    <tr>
                                        <td colspan="3" class="loading-cell">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Secret Types Donut Chart -->
                    <div class="chart-section">
                        <div class="section-header">
                            <h2 class="section-title">üîê –¢–∏–ø—ã —Å–µ–∫—Ä–µ—Ç–æ–≤</h2>
                        </div>
                        <div class="chart-container-small">
                            <canvas id="secretTypesChart"></canvas>
                        </div>
                        <div class="chart-legend" id="secretTypesLegend">
                            <!-- Legends will be generated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Top File Extensions Chart -->
                <div class="chart-section">
                    <div class="section-header">
                        <h2 class="section-title">üìÅ –¢–æ–ø —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="fileExtensionsChart"></canvas>
                    </div>
                    <div class="chart-legend" id="fileExtensionsLegend">
                        <!-- Legends will be generated by JS -->
                    </div>
                </div>
            </div>

            <!-- Scans Tab -->
            <div class="stats-tab-content" id="scans-content">
                <!-- Scan Activity Chart -->
                <div class="chart-section">
                    <div class="section-header">
                        <h2 class="section-title">üìä –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h2>
                        <div class="period-selector">
                            <button class="period-btn active" data-period-scan="30">30 –¥–Ω–µ–π</button>
                            <button class="period-btn" data-period-scan="90">90 –¥–Ω–µ–π</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="scanActivityChart"></canvas>
                    </div>
                    <div class="chart-legend" id="scanActivityLegend">
                        <div class="legend-item">
                            <span class="legend-color" style="background: #48bb78;"></span>
                            <span class="legend-label">Completed</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #f56565;"></span>
                            <span class="legend-label">Failed</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #ed8936;"></span>
                            <span class="legend-label">Running</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div class="stats-tab-content" id="analytics-content">
                <!-- Confidence Accuracy Chart -->
                <div class="chart-section">
                    <div class="section-header">
                        <h2 class="section-title">üéØ –¢–æ—á–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏ –ø–æ confidence</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="confidenceChart"></canvas>
                    </div>
                    <div class="chart-legend" id="confidenceLegend">
                        <div class="legend-item">
                            <span class="legend-color" style="background: #48bb78;"></span>
                            <span class="legend-label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #f56565;"></span>
                            <span class="legend-label">–û–ø—Ä–æ–≤–µ—Ä–≥–Ω—É—Ç—ã</span>
                        </div>
                    </div>
                </div>

                <!-- Secrets Lists with Tabs -->
                <div class="chart-section">
                    <div class="section-header">
                        <h2 class="section-title">üì∂ –ê–Ω–∞–ª–∏–∑ —Ç–æ—á–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏</h2>
                    </div>
                    
                    <!-- Internal Tabs -->
                    <div class="stats-tabs-internal">
                        <button class="stats-tab-internal active" data-tab-internal="low-confidence">
                            üìâ –ù–∏–∑–∫–∏–π confidence, –Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ
                        </button>
                        <button class="stats-tab-internal" data-tab-internal="high-confidence">
                            üìà –í—ã—Å–æ–∫–∏–π confidence, –Ω–æ –æ–ø—Ä–æ–≤–µ—Ä–≥–Ω—É—Ç–æ
                        </button>
                    </div>
                    
                    <div class="tab-content-internal-wrapper">
                        <!-- Tab 1: Low Confidence Confirmed -->
                        <div class="stats-tab-content-internal active" id="low-confidence-content">
                            <div class="table-container">
                                <table class="top-projects-table" id="lowConfidenceTable">
                                    <thead>
                                        <tr>
                                            <th>‚Ññ</th>
                                            <th>–ü—Ä–æ–µ–∫—Ç</th>
                                            <th>–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ</th>
                                            <th>–¢–∏–ø</th>
                                            <th>–°–µ–∫—Ä–µ—Ç</th>
                                            <th>Confidence</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lowConfidenceBody">
                                        <tr>
                                            <td colspan="6" class="loading-cell">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- Pagination -->
                            <div class="pagination-container" id="lowConfidencePagination" style="display: none;">
                                <button class="pagination-btn" id="lowConfidencePrevBtn" disabled>‚Üê –ù–∞–∑–∞–¥</button>
                                <span class="pagination-info" id="lowConfidencePageInfo">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 8</span>
                                <button class="pagination-btn" id="lowConfidenceNextBtn">–í–ø–µ—Ä–µ–¥ ‚Üí</button>
                            </div>
                        </div>
                        
                        <!-- Tab 2: High Confidence Refuted -->
                        <div class="stats-tab-content-internal" id="high-confidence-content">
                            <div class="table-container">
                                <table class="top-projects-table" id="highConfidenceTable">
                                    <thead>
                                        <tr>
                                            <th>‚Ññ</th>
                                            <th>–ü—Ä–æ–µ–∫—Ç</th>
                                            <th>–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ</th>
                                            <th>–¢–∏–ø</th>
                                            <th>–°–µ–∫—Ä–µ—Ç</th>
                                            <th>Confidence</th>
                                        </tr>
                                    </thead>
                                    <tbody id="highConfidenceBody">
                                        <tr>
                                            <td colspan="6" class="loading-cell">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- Pagination -->
                            <div class="pagination-container" id="highConfidencePagination" style="display: none;">
                                <button class="pagination-btn" id="highConfidencePrevBtn" disabled>‚Üê –ù–∞–∑–∞–¥</button>
                                <span class="pagination-info" id="highConfidencePageInfo">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 8</span>
                                <button class="pagination-btn" id="highConfidenceNextBtn">–í–ø–µ—Ä–µ–¥ ‚Üí</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner"></div>
            <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
        </div>
    </div>

    <script src="/secret_scanner/static/js/stats_dashboard.js"></script>
</body>
</html>
