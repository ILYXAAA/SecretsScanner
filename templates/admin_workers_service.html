<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–∞–º–∏ - Secrets Scanner</title>
    <link rel="stylesheet" href="/secret_scanner/static/css/base_header.css">
    <link rel="stylesheet" href="/secret_scanner/static/css/admin_workers_service.css">
    <link rel="icon" type="image/x-icon" href="/secret_scanner/favicon.ico">
</head>
<body>
    {% from "components/base_header.html" import header %}
    {{ header('admin/workers', current_user) }}
    {% from "components/icon.html" import icon %}
    
    <div class="container">
        <div class="page-header">
            <h1 class="page-title">üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º</h1>
            <div class="header-actions">
                <label class="toggle-switch">
                    <input type="checkbox" id="autoRefreshToggle" checked>
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
                </label>
            </div>
        </div>

        <!-- System and Queue Statistics -->
        <div class="stats-grid">
            <div class="stat-card system-stats">
                <h3>üñ•Ô∏è –°–∏—Å—Ç–µ–º–∞ (–Ω–µ—Ç–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)</h3>
                <div class="stat-content">
                    <div class="stat-item">
                        <span class="stat-label">{{ icon("time", 22)}} –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:</span>
                        <span class="stat-value" id="uptime">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">{{ icon("cpu", 22)}} CPU:</span>
                        <span class="stat-value" id="cpu-usage">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">{{ icon("ram", 22)}} RAM:</span>
                        <span class="stat-value" id="memory-usage">-</span>
                    </div>
                </div>
                <div class="system-action">
                    <button class="btn btn-info btn-medium" onclick="refreshSystemStats()">
                        {{ icon("update", 20)}} –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>

            <div class="stat-card queue-stats">
                <h3>
                    üìã –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á
                    <span class="tasks-count">(<span id="pending-tasks-quicknum">0</span>)</span>
                </h3>
                <div class="stat-content">
                    <div class="stat-item">
                        <span class="stat-label">‚åõ –í –æ–∂–∏–¥–∞–Ω–∏–∏:</span>
                        <span class="stat-value pending" id="pending-tasks">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">üõ†Ô∏è –í –ø—Ä–æ—Ü–µ—Å—Å–µ:</span>
                        <span class="stat-value processing" id="processing-tasks">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ:</span>
                        <span class="stat-value completed" id="completed-tasks">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">‚ùå –û—à–∏–±–∫–∏:</span>
                        <span class="stat-value failed" id="failed-tasks">-</span>
                    </div>
                </div>
                <div class="queue-actions">
                    <button class="btn btn-danger btn-small" onclick="cleanupOldTasks()">
                        {{ icon("delete", 18)}} –ü–æ—á–∏—Å—Ç–∏—Ç—å –∑–∞–¥–∞—á–∏
                    </button>
                    <div class="btn-description">–£–¥–∞–ª—è–µ—Ç –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –∑–∞–¥–∞—á–∏, —Ñ–∏–∫—Å–∏—Ç –∑–∞–¥–∞—á–∏-–ø–æ—Ç–µ—Ä—è—à–∫–∏</div>
                </div>
            </div>
        </div>

        <!-- Workers List -->
        <div class="workers-section">
            <div class="section-header">
                <h2 id="workers-title">üë∑ –°–ø–∏—Å–æ–∫ –≤–æ—Ä–∫–µ—Ä–æ–≤</h2>
                <button class="add-worker-btn" onclick="addWorker()">
                    ü§ñ –î–æ–±–∞–≤–∏—Ç—å
                </button>
            </div>
            
            <div class="workers-grid" id="workers-grid">
                <!-- Workers will be populated here -->
            </div>

            <div class="empty-state" id="empty-workers" style="display: none;">
                <h3>–ù–µ—Ç –≤–æ—Ä–∫–µ—Ä–æ–≤</h3>
                <p>–í–æ—Ä–∫–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω—ã</p>
            </div>
        </div>

        <!-- Tasks Management Section -->
        <div class="tasks-section">
            <div class="section-header">
                <h2>üìã –ó–∞–¥–∞—á–∏</h2>
                <div class="tasks-controls">
                    <input type="text" id="projectSearch" class="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –ø—Ä–æ–µ–∫—Ç—É/–∫–æ–º–º–∏—Ç—É.." onkeyup="searchTasks()">
                    <select id="tasksFilter" class="filter-select" onchange="filterTasks()">
                        <option value="">–í—Å–µ –∑–∞–¥–∞—á–∏</option>
                        <option value="pending">‚åõ –í –æ–∂–∏–¥–∞–Ω–∏–∏</option>
                        <option value="downloading,unpacking,scanning,ml_validation">üõ†Ô∏è –í –ø—Ä–æ—Ü–µ—Å—Å–µ</option>
                        <option value="completed">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</option>
                        <option value="failed">‚ùå –ü—Ä–æ–≤–∞–ª–µ–Ω–Ω—ã–µ</option>
                    </select>
                    <select id="workerFilter" class="filter-select" onchange="filterTasks()">
                        <option value="">–í—Å–µ –≤–æ—Ä–∫–µ—Ä—ã</option>
                    </select>
                    <select id="taskTypeFilter" class="filter-select" onchange="filterTasks()">
                        <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                    </select>
                    <input type="number" id="tasksLimit" placeholder="–õ–∏–º–∏—Ç" min="1" max="1000" value="200" onchange="filterTasks()">
                    <button class="btn btn-info btn-small" onclick="refreshTasks()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
            </div>
            
            <!-- <div class="tasks-tabs">
                <button class="task-tab active" data-tab="all" onclick="switchTab('all')">üìã –í—Å–µ</button>
                <button class="task-tab" data-tab="pending" onclick="switchTab('pending')">‚åõ –í –æ–∂–∏–¥–∞–Ω–∏–∏</button>
                <button class="task-tab" data-tab="processing" onclick="switchTab('processing')">üõ†Ô∏è –í –ø—Ä–æ—Ü–µ—Å—Å–µ</button>
                <button class="task-tab" data-tab="completed" onclick="switchTab('completed')">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</button>
                <button class="task-tab" data-tab="failed" onclick="switchTab('failed')">‚ùå –ü—Ä–æ–≤–∞–ª–µ–Ω–Ω—ã–µ</button>
            </div> -->
            
            <div class="tasks-content">
                <div class="tasks-analytics" id="tasks-analytics">
                    <!-- Analytics will be populated here -->
                </div>
                
                <div class="tasks-list" id="tasks-list">
                    <!-- Tasks will be populated here -->
                </div>
                
                <div class="empty-state" id="empty-tasks" style="display: none;">
                    <h3>–ó–∞–¥–∞—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                    <p>–ù–µ—Ç –∑–∞–¥–∞—á –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å —Ç–µ–∫—É—â–∏–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏</p>
                </div>
                
                <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
                <div class="pagination" id="pagination" style="display: none;">
                    <button id="prevPageBtn" onclick="goToPage(currentPage - 1)">‚Äπ –ù–∞–∑–∞–¥</button>
                    <span id="pageInfo">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 1</span>
                    <button id="nextPageBtn" onclick="goToPage(currentPage + 1)">–í–ø–µ—Ä–µ–¥ ‚Ä∫</button>
                </div>
            </div>
        </div>

        <!-- Auto-refresh indicator -->
        <div class="refresh-indicator">
            <span id="refresh-status">üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</span>
            <span id="last-update">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –Ω–∏–∫–æ–≥–¥–∞</span>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3>–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ü–∏—è...</h3>
            <p id="loading-message">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ</p>
        </div>
    </div>

    <!-- Confirmation Dialog -->
    <div class="confirmation-dialog" id="confirmationDialog">
        <div class="dialog-content">
            <h3 class="dialog-title" id="dialog-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
            <div class="dialog-message" id="dialog-message"></div>
            <div class="dialog-actions">
                <button class="btn btn-secondary" id="cancelBtn" onclick="hideConfirmDialog()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-danger" id="confirmBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script src="/secret_scanner/static/js/admin_workers_service.js"></script>
</body>
</html>